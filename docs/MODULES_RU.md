# 📦 Подробный обзор модулей FRADECT

## Обзор

FRADECT состоит из трех основных модулей, каждый из которых решает специфические задачи управления рисками:

```
┌─────────────────────────────────────────────────────────────────┐
│                      ПЛАТФОРМА FRADECT                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐       │
│  │ ЭЛЕКТРОННАЯ  │   │  ФИНАНСОВЫЕ  │   │  ПРОЕКТНЫЕ   │       │
│  │  КОММЕРЦИЯ   │   │    РИСКИ     │   │    РИСКИ     │       │
│  └──────────────┘   └──────────────┘   └──────────────┘       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Модуль 1: Риски электронной коммерции

### Постановка проблемы

Онлайн-ритейлеры теряют **1.5-3.5% выручки** из-за различных видов мошенничества:
- Платежное мошенничество (украденные карты, взлом аккаунтов)
- Злоупотребление возвратами (примерка на дому, возвраты пустых коробок)
- Злоупотребление промокодами (множественные аккаунты, фермы купонов)

Для магазина с выручкой 100М ₽ это означает **1.5-3.5М ₽ годовых потерь**.

### Подмодули

#### 1.1 Обнаружение платежного мошенничества

**Входные данные:**
```python
{
  "transaction_id": "txn_123456",
  "amount": 15000,
  "currency": "RUB",
  "customer": {
    "id": "cust_789",
    "email": "user@example.com",
    "phone": "+79161234567",
    "registration_date": "2024-01-15",
    "total_orders": 3
  },
  "device": {
    "fingerprint": "fp_abc123",
    "ip": "93.170.123.45",
    "user_agent": "...",
    "timezone": "Europe/Moscow"
  },
  "shipping_address": {...},
  "billing_address": {...},
  "timestamp": "2025-10-01T10:30:00Z"
}
```

**Анализируемые факторы риска:**
```
├─ Отпечаток устройства
│  ├─ Известное мошенническое устройство?
│  ├─ Множественные аккаунты с этого устройства?
│  └─ Несоответствие устройства и локации?
│
├─ Поведенческие сигналы
│  ├─ Время на сайте перед покупкой
│  ├─ Паттерн навигации
│  ├─ Копирование-вставка в формах (признак credential stuffing)
│  └─ Множественные неудачные попытки оплаты
│
├─ Проверки скорости
│  ├─ Множественные заказы за короткое время?
│  ├─ Одна карта на нескольких аккаунтах?
│  └─ Мгновенное оформление (поведение бота)?
│
├─ Сетевой анализ
│  ├─ Репутация домена email
│  ├─ Геолокация IP vs адрес доставки
│  ├─ Использование VPN/прокси
│  └─ Кластеры отпечатков устройств
│
└─ Исторические паттерны
   ├─ История платежей клиента
   ├─ Результаты похожих транзакций
   └─ История адресов (успешность доставки)
```

**Результат:**
```python
{
  "risk_score": 720,  # Шкала 0-1000
  "risk_tier": "HIGH",  # LOW/MEDIUM/HIGH/CRITICAL
  "recommendation": "REVIEW",  # APPROVE/REVIEW/DECLINE
  "confidence": 0.87,
  "expected_loss": 12750,  # Вероятность 85% * сумма 15000
  "risk_factors": [
    {
      "factor": "device_fingerprint_blacklist",
      "impact": -180,
      "description": "Устройство связано с 3 предыдущими чарджбэками"
    },
    {
      "factor": "velocity_check_failed",
      "impact": -120,
      "description": "4-й заказ за 2 часа"
    },
    {
      "factor": "geolocation_mismatch",
      "impact": -95,
      "description": "IP в Москве, доставка во Владивосток"
    }
  ],
  "suggested_actions": [
    "Запросить дополнительную верификацию (фото паспорта)",
    "Связаться с клиентом по телефону",
    "Отправить с подтверждением получателя"
  ]
}
```

**Поток интеграции:**
```
Оформление заказа клиентом
     ↓
CMS (Insales/Tilda)
     ↓
FRADECT API (< 300мс ответ)
     ↓
┌─────────────────┐
│ Если APPROVE:   │ → Платежный шлюз → Банк
│ Если REVIEW:    │ → Очередь ручной проверки
│ Если DECLINE:   │ → Показать дружелюбную ошибку
└─────────────────┘
```

#### 1.2 Обнаружение злоупотребления возвратами

**Проблема:** Серийные возвратчики, вардробинг (носят и возвращают), возвраты пустых коробок.

**Входные данные:**
```python
{
  "customer_id": "cust_789",
  "order_history": [
    {"order_id": "ord_001", "returned": true, "reason": "не подошёл"},
    {"order_id": "ord_002", "returned": true, "reason": "не тот цвет"},
    {"order_id": "ord_003", "returned": false},
    {"order_id": "ord_004", "returned": true, "reason": "проблема с качеством"}
  ],
  "return_request": {
    "order_id": "ord_005",
    "items": [{...}],
    "reason": "не подходит",
    "timestamp": "2025-10-01T15:00:00Z"
  }
}
```

**Паттерны риска:**
```
├─ Частота возвратов
│  └─ >40% возвратов (среднее по отрасли: 15-20%)
│
├─ Временные паттерны
│  ├─ Возвраты после важных событий (носили на мероприятие?)
│  └─ Постоянный период возврата (всегда день 29 из 30)
│
├─ Специфика товаров
│  ├─ Только дорогие товары
│  ├─ Сезонные товары (платья перед свадебным сезоном)
│  └─ Бирки сняты vs сохранены
│
└─ Перекрестные ссылки
   ├─ Посты в соцсетях (фото в возвращенном товаре?)
   └─ Множественные аккаунты, один адрес
```

**Результат:**
```python
{
  "abuse_score": 850,
  "classification": "SERIAL_RETURNER",
  "recommendation": "RESTRICT_RETURNS",
  "actions": [
    "Пометить аккаунт для ручного одобрения будущих возвратов",
    "Взимать 15% комиссию за возврат",
    "Требовать фото подтверждение дефекта"
  ],
  "lifetime_value_at_risk": -2500  # Отрицательная ценность клиента
}
```

#### 1.3 Злоупотребление промокодами

**Проблема:** Пользователи создают множественные аккаунты для злоупотребления скидками первого заказа, реферальными программами.

**Методы обнаружения:**
```
├─ Отпечаток устройства
│  └─ Одно устройство, множественные аккаунты
│
├─ Сетевой анализ
│  ├─ Паттерны email (name+1@, name+2@)
│  ├─ Кластеры телефонных номеров
│  └─ Вариации адресов (Кв. 1, Кв. 1А, Кв. #1)
│
├─ Поведенческие
│  ├─ Аккаунты созданы подряд
│  ├─ Идентичное содержимое корзин
│  └─ Оформление в течение минут после регистрации
│
└─ Социальный граф
   └─ Реферальные цепочки (A→B→C→D, все с одного IP)
```

---

## Модуль 2: Финансовые риски

### Постановка проблемы

Компании с отсрочкой платежа (B2B, дистрибьюторы) сталкиваются с:
- **20-40% выручки заблокировано в дебиторской задолженности**
- **5-15% становится безнадежной задолженностью** (никогда не взыскать)
- Неэффективные усилия по взысканию (преследование неплатежеспособных должников)

### Подмодули

#### 2.1 Скоринг риска должника

**Перед предоставлением отсрочки**, прогнозируем: заплатит ли этот клиент вовремя?

**Входные данные:**
```python
{
  "client_id": "client_456",
  "invoice_history": [
    {
      "invoice_id": "inv_001",
      "amount": 50000,
      "due_date": "2025-08-01",
      "paid_date": "2025-08-15",  # Опоздание на 14 дней
      "delay_days": 14
    },
    # ... больше истории
  ],
  "company_info": {
    "industry": "розница",
    "size": "10-50 сотрудников",
    "years_in_business": 7,
    "public_filings": {...}  # если доступно
  },
  "external_data": {
    "fssp_records": false,  # нет записей у приставов
    "legal_cases": 0,
    "credit_bureau_score": null  # если доступно
  },
  "requested_credit": 100000,
  "payment_terms": "net_30"
}
```

**Инженерия признаков:**
```python
features = [
    # Платежное поведение
    payment_punctuality_rate,  # % своевременных платежей
    avg_delay_days,
    max_delay_days,
    payment_trend,  # улучшается/стабильно/ухудшается
    
    # Финансовая экспозиция
    current_outstanding_debt,
    credit_utilization,  # задолженность / лимит
    
    # Временные
    days_since_last_payment,
    payment_frequency,
    seasonal_patterns,
    
    # Бизнес-контекст
    industry_risk_factor,
    company_age,
    relationship_length,
    
    # Внешние сигналы
    has_legal_issues,
    fssp_records,
    public_negative_news
]
```

**Результат модели:**
```python
{
  "risk_score": 425,  # 0-1000, меньше = лучше
  "risk_tier": "B",  # Шкала A-F
  "default_probability": 0.12,  # 12% вероятность неплатежа
  "recommended_credit_limit": 75000,  # меньше запрошенного
  "payment_terms": "net_15",  # ужесточить условия
  "required_prepayment": 0.25,  # 25% предоплата
  
  "risk_factors": [
    {
      "factor": "payment_trend_worsening",
      "impact": "Последние 3 счета в среднем опаздывают на 18 дней vs 8 дней ранее"
    },
    {
      "factor": "high_credit_utilization",
      "impact": "Используется 85% существующего лимита"
    }
  ],
  
  "predicted_behavior": {
    "expected_payment_date": "2025-11-17",  # 17 дней после срока
    "confidence_interval": ["2025-11-10", "2025-11-25"]
  }
}
```

#### 2.2 Динамические кредитные лимиты

**Автоматическая корректировка лимитов** на основе поведения в реальном времени.

**Логика:**
```python
if payment_trend == "improving" and punctuality > 0.9:
    action = "increase_limit"
    new_limit = current_limit * 1.2
    
elif payment_trend == "worsening" or max_delay > 45:
    action = "decrease_limit"
    new_limit = current_limit * 0.7
    notify_account_manager = True
    
elif outstanding > (limit * 0.8):
    action = "block_new_orders"
    message = "Снизьте задолженность ниже 80% для продолжения"
```

#### 2.3 Приоритизация взыскания

**Какие долги преследовать в первую очередь?**

**Скоринг:**
```python
collection_priority_score = (
    debt_amount * recoverability_prob * urgency_factor
) / collection_cost_estimate

где:
  recoverability_prob = f(
      client_financial_health,
      relationship_quality,
      legal_collectability
  )
  
  urgency_factor = f(
      days_overdue,
      debt_aging_category  # 0-30, 31-60, 61-90, 90+
  )
```

**Результат:**
```python
[
  {
    "client": "Клиент А",
    "debt": 150000,
    "days_overdue": 45,
    "priority_score": 8.5,
    "recovery_prob": 0.75,
    "recommended_action": "Личный звонок от менеджера",
    "expected_recovery": 112500
  },
  {
    "client": "Клиент Б",
    "debt": 80000,
    "days_overdue": 120,
    "priority_score": 3.2,
    "recovery_prob": 0.20,
    "recommended_action": "Передать коллекторскому агентству",
    "expected_recovery": 16000
  }
]
```

---

## Модуль 3: Проектные риски

### Постановка проблемы

**70% проектов** превышают бюджет и/или сроки.

Общие причины:
- Оптимистичные начальные оценки
- Расширение объема работ
- Неправильная команда/подрядчик
- Скрытые зависимости
- Задержки платежей от клиента

### Подмодули

#### 3.1 Оценка рисков при старте проекта

**Перед началом**, оценить вероятность успеха проекта.

**Входные данные:**
```python
{
  "project": {
    "name": "Интеграция ERP системы",
    "description": "...",
    "estimated_budget": 2000000,
    "estimated_duration_days": 180,
    "scope": "...",
    "client": "..."
  },
  "team": [
    {"role": "PM", "experience_years": 3, "similar_projects": 2},
    {"role": "Dev", "experience_years": 5, "tech_stack_match": 0.8}
  ],
  "dependencies": [
    "Клиент предоставит доступ к API до Недели 2",
    "Интеграция со сторонним вендором"
  ]
}
```

**Анализ:**
```python
# Сравнение с историческими похожими проектами
similar_projects = find_similar(
    scope=current.scope,
    budget_range=current.budget * [0.7, 1.3],
    industry=current.client.industry
)

historical_outcomes = [
    {"budget_overrun": 1.45, "timeline_overrun": 1.30},
    {"budget_overrun": 1.20, "timeline_overrun": 1.15},
    {"budget_overrun": 1.80, "timeline_overrun": 1.60},
    # ... ещё 7
]

avg_budget_overrun = 1.48  # +48%
avg_timeline_overrun = 1.35  # +35%
success_rate = 0.30  # 30% уложились в бюджет и сроки
```

**Результат:**
```python
{
  "success_probability": 0.35,
  "predicted_final_budget": 2960000,  # +48%
  "predicted_final_timeline": 243,  # +35% дней
  
  "risk_factors": [
    {
      "factor": "Несоответствие опыта команды",
      "severity": "HIGH",
      "impact": "У PM только 2 похожих проекта, среднее 5+",
      "mitigation": "Привлечь старшего PM как советника"
    },
    {
      "factor": "Внешние зависимости",
      "severity": "MEDIUM",
      "impact": "Зависимость от API клиента исторически задерживает 30% проектов",
      "mitigation": "Создать мокап среду, не ждать клиента"
    },
    {
      "factor": "Неопределенность объема",
      "severity": "HIGH",
      "impact": "Неясные требования ведут к 50%+ расширению объема",
      "mitigation": "Провести 2-недельную фазу исследования перед фиксацией цены"
    }
  ],
  
  "recommendation": "NEGOTIATE",
  "suggested_changes": {
    "budget": 3000000,  # Добавить буфер
    "timeline": 240,  # Добавить буфер
    "payment_terms": "40% предоплата, 30% на этапе 1, 30% при сдаче",
    "scope": "Фиксированный объем с процессом изменений"
  }
}
```

#### 3.2 Скоринг подрядчиков

**Перед подписанием контракта**, оценить способность подрядчика выполнить работу.

**Факторы риска:**
```
├─ Финансовое здоровье
│  ├─ Последние финансовые отчеты
│  ├─ Платежи поставщикам (задержки?)
│  └─ Незакрытые судебные дела
│
├─ Стабильность команды
│  ├─ Текучесть кадров
│  ├─ Уход ключевых сотрудников
│  └─ Массовый найм (перегрузка?)
│
├─ Соответствие портфолио
│  ├─ Похожие выполненные проекты
│  ├─ Соответствие техническим возможностям
│  └─ Опыт в отрасли
│
├─ История поставок
│  ├─ % своевременных поставок
│  ├─ Соблюдение бюджета
│  └─ Оценки удовлетворенности клиентов
│
└─ Мощности
   ├─ Текущая загрузка проектами
   ├─ Доступные ресурсы
   └─ Зависимость от субподрядчиков
```

#### 3.3 Риск клиента проекта

**Будет ли КЛИЕНТ проблемой?**

**Паттерны риска:**
```
├─ История платежей
│  └─ Поздние платежи по прошлым проектам?
│
├─ Принятие решений
│  ├─ Медленные процессы согласования
│  └─ Частая смена руководства
│
├─ Управление объемом
│  ├─ История расширения объема
│  └─ Неясные требования
│
└─ Коммуникация
   └─ Отзывчивость, ясность
```

---

## Синергия между модулями

### Единый обзор рисков

```python
# 360° профиль риска клиента
customer_risk = {
    "ecommerce": {
        "fraud_score": 250,  # Низкий риск
        "return_abuse_score": 120,  # Низкий риск
    },
    "financial": {
        "payment_risk": 680,  # Средне-высокий риск
        "current_ar": 50000,
    },
    "project": {
        "scope_creep_prob": 0.65,  # Высокий риск
        "payment_delay_prob": 0.40
    },
    
    "overall_risk": "СРЕДНЕ-ВЫСОКИЙ",
    "recommended_strategy": "Принимать заказы только с предоплатой"
}
```

### Общее обучение

Инсайты из одного модуля информируют другие:
- Задержки платежей в ДЗ → пометить как рискованного клиента проекта
- Злоупотребление возвратами в e-commerce → ужесточить условия оплаты проекта
- Расширение объема проекта → уменьшить кредитный лимит

---

## Приоритет внедрения

### Фаза 1 (MVP): Модуль электронной коммерции
**Почему:** Самый быстрый ROI, четкие метрики, проще доступ к данным

### Фаза 2: Финансовый модуль
**Почему:** Основывается на платежных данных, высокое влияние на бизнес

### Фаза 3: Проектный модуль
**Почему:** Более сложный, требует исторических данных проектов

---

**Далее:** См. [ARCHITECTURE_RU.md](ARCHITECTURE_RU.md) для технических деталей реализации.
